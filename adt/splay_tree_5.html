<!DOCTYPE html><html lang="en"><head><title>adt/splay_tree_5</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="adt/splay_tree_5"><meta name="groc-project-path" content="js/src/adt/splay_tree_5.js"><meta name="groc-github-url" content="https://github.com/aureooms/js-algo"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/aureooms/js-algo/blob/master/js/src/adt/splay_tree_5.js">js/src/adt/splay_tree_5.js</a></div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> splay_tree_5_t = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(diff)</span>{</span>

	<span class="hljs-keyword">var</span> node = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(v)</span>{</span>
		<span class="hljs-keyword">this</span>.l = <span class="hljs-keyword">this</span>.r = <span class="hljs-literal">null</span>;
		<span class="hljs-keyword">this</span>.v = v;
	};

	<span class="hljs-keyword">var</span> in_order_traversal = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(pt, fn)</span>{</span>
		<span class="hljs-keyword">if</span>(pt.l !== <span class="hljs-literal">null</span>) in_order_traversal(pt.l, fn);
		fn(pt.v);
		<span class="hljs-keyword">if</span>(pt.r !== <span class="hljs-literal">null</span>) in_order_traversal(pt.r, fn);
	};

	<span class="hljs-keyword">var</span> splay_tree = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span> <span class="hljs-keyword">this</span>.pt = <span class="hljs-literal">null</span>; };

	splay_tree.prototype.splay = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(v)</span>{</span>

		<span class="hljs-keyword">var</span> l, r, t, y, x, d;
		l = r = x = <span class="hljs-keyword">new</span> node();
		t = <span class="hljs-keyword">this</span>.pt;
		<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
			d = diff(v, t.v);
			<span class="hljs-keyword">if</span> (d &lt; <span class="hljs-number">0</span>) {
				<span class="hljs-keyword">if</span> (!t.l) <span class="hljs-keyword">break</span>;
				<span class="hljs-keyword">if</span> (diff(v, t.l.v) &lt; <span class="hljs-number">0</span>) {
					y = t.l;
					t.l = y.r;
					y.r = t;
					t = y;
					<span class="hljs-keyword">if</span> (!t.l) <span class="hljs-keyword">break</span>;
				}
				r.l = t;
				r = t;
				t = t.l;
			}
			<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (d &gt; <span class="hljs-number">0</span>) {
				<span class="hljs-keyword">if</span> (!t.r) <span class="hljs-keyword">break</span>;
				<span class="hljs-keyword">if</span> (diff(v, t.r.v) &gt; <span class="hljs-number">0</span>) {
					y = t.r;
					t.r = y.l;
					y.l = t;
					t = y;
					<span class="hljs-keyword">if</span> (!t.r) <span class="hljs-keyword">break</span>;
				}
				l.r = t;
				l = t;
				t = t.r;
			}
			<span class="hljs-keyword">else</span> <span class="hljs-keyword">break</span>;
		}
		l.r = t.l;
		r.l = t.r;
		t.l = x.r;
		t.r = x.l;

		<span class="hljs-keyword">this</span>.pt = t;

		<span class="hljs-keyword">return</span> d;
	};

	splay_tree.prototype.remove = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(v)</span>{</span>
		<span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.pt === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;
		
		<span class="hljs-keyword">var</span> d = <span class="hljs-keyword">this</span>.splay(v);
		<span class="hljs-keyword">if</span> (d !== <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;

		<span class="hljs-keyword">if</span>      (<span class="hljs-keyword">this</span>.pt.l === <span class="hljs-literal">null</span>) <span class="hljs-keyword">this</span>.pt = <span class="hljs-keyword">this</span>.pt.r;
		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.pt.r === <span class="hljs-literal">null</span>) <span class="hljs-keyword">this</span>.pt = <span class="hljs-keyword">this</span>.pt.l;
		<span class="hljs-keyword">else</span> {
			<span class="hljs-keyword">var</span> tmp = <span class="hljs-keyword">this</span>.pt.r;
			<span class="hljs-keyword">this</span>.pt = <span class="hljs-keyword">this</span>.pt.l;
			<span class="hljs-keyword">this</span>.splay(v);
			<span class="hljs-keyword">this</span>.pt.r = tmp;
		}
	};



	splay_tree.prototype.insert = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(v)</span>{</span>
		<span class="hljs-keyword">var</span> n = <span class="hljs-keyword">new</span> node(v);
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.pt !== <span class="hljs-literal">null</span>) {
			<span class="hljs-keyword">var</span> d = <span class="hljs-keyword">this</span>.splay(v);

			<span class="hljs-keyword">if</span> (d &lt;= <span class="hljs-number">0</span>) {
				n.l = <span class="hljs-keyword">this</span>.pt.l;
				n.r = <span class="hljs-keyword">this</span>.pt;
				<span class="hljs-keyword">this</span>.pt.l = <span class="hljs-literal">null</span>;
			}
			<span class="hljs-keyword">else</span> {
				n.r = <span class="hljs-keyword">this</span>.pt.r;
				n.l = <span class="hljs-keyword">this</span>.pt;
				<span class="hljs-keyword">this</span>.pt.r = <span class="hljs-literal">null</span>;
			}
		}
		<span class="hljs-keyword">this</span>.pt = n;
	};

	splay_tree.prototype.find = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(v)</span>{</span>
		<span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.pt === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> [<span class="hljs-literal">false</span>, <span class="hljs-literal">null</span>];
		<span class="hljs-keyword">var</span> d = <span class="hljs-keyword">this</span>.splay(v);
		<span class="hljs-keyword">return</span> [d === <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.pt.v];
	};

	splay_tree.prototype.in_order_traversal = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span>{</span>
		<span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.pt !== <span class="hljs-literal">null</span>) in_order_traversal(<span class="hljs-keyword">this</span>.pt, fn);
	};

	<span class="hljs-keyword">return</span> splay_tree;

};

exports.splay_tree_5_t = splay_tree_5_t;</div></div></div></div></body></html>