<!DOCTYPE html><html lang="en"><head><title>adt/splay_tree_3</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="adt/splay_tree_3"><meta name="groc-project-path" content="js/src/adt/splay_tree_3.js"><meta name="groc-github-url" content="https://github.com/aureooms/js-algo"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/aureooms/js-algo/blob/master/js/src/adt/splay_tree_3.js">js/src/adt/splay_tree_3.js</a></div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> splay_tree_3_t = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(diff)</span>{</span>

	<span class="hljs-keyword">var</span> insert = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(pt, v)</span>{</span>
		<span class="hljs-keyword">var</span> w = diff(v, pt[<span class="hljs-number">2</span>]) &gt; <span class="hljs-number">0</span> | <span class="hljs-number">0</span>;
		<span class="hljs-keyword">if</span>   (pt[w] === <span class="hljs-literal">null</span>) pt[w] = [<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, v];
		<span class="hljs-keyword">else</span> insert(pt[w], v);
	};

	<span class="hljs-keyword">var</span> splay = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el, v)</span>{</span>

		<span class="hljs-keyword">var</span> l, r, t, y, x, d;
		l = r = x = [<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">undefined</span>];
		t = el;
		<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
			d = diff(v, t[<span class="hljs-number">2</span>]);
			<span class="hljs-keyword">if</span> (d &lt; <span class="hljs-number">0</span>) {
				<span class="hljs-keyword">if</span> (!t[<span class="hljs-number">0</span>]) <span class="hljs-keyword">break</span>;
				<span class="hljs-keyword">if</span> (diff(v, t[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>]) &lt; <span class="hljs-number">0</span>) {
					y = t[<span class="hljs-number">0</span>];
					t[<span class="hljs-number">0</span>] = y[<span class="hljs-number">1</span>];
					y[<span class="hljs-number">1</span>] = t;
					t = y;
					<span class="hljs-keyword">if</span> (!t[<span class="hljs-number">0</span>]) <span class="hljs-keyword">break</span>;
				}
				r[<span class="hljs-number">0</span>] = t;
				r = t;
				t = t[<span class="hljs-number">0</span>];
			}
			<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (d &gt; <span class="hljs-number">0</span>) {
				<span class="hljs-keyword">if</span> (!t[<span class="hljs-number">1</span>]) <span class="hljs-keyword">break</span>;
				<span class="hljs-keyword">if</span> (diff(v, t[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>]) &gt; <span class="hljs-number">0</span>) {
					y = t[<span class="hljs-number">1</span>];
					t[<span class="hljs-number">1</span>] = y[<span class="hljs-number">0</span>];
					y[<span class="hljs-number">0</span>] = t;
					t = y;
					<span class="hljs-keyword">if</span> (!t[<span class="hljs-number">1</span>]) <span class="hljs-keyword">break</span>;
				}
				l[<span class="hljs-number">1</span>] = t;
				l = t;
				t = t[<span class="hljs-number">1</span>];
			}
			<span class="hljs-keyword">else</span> <span class="hljs-keyword">break</span>;
		}
		l[<span class="hljs-number">1</span>] = t[<span class="hljs-number">0</span>];
		r[<span class="hljs-number">0</span>] = t[<span class="hljs-number">1</span>];
		t[<span class="hljs-number">0</span>] = x[<span class="hljs-number">1</span>];
		t[<span class="hljs-number">1</span>] = x[<span class="hljs-number">0</span>];

		<span class="hljs-keyword">return</span> [diff(v, t[<span class="hljs-number">2</span>]) === <span class="hljs-number">0</span>, t];
	};

	<span class="hljs-keyword">var</span> remove = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el, v)</span>{</span>
		<span class="hljs-keyword">var</span> r = splay(el, v);
		<span class="hljs-keyword">if</span> (!r[<span class="hljs-number">0</span>]) <span class="hljs-keyword">return</span> r[<span class="hljs-number">1</span>];

		<span class="hljs-keyword">if</span>      (r[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> r[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>];
		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (r[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> r[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>];
		<span class="hljs-keyword">else</span> {
			r[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] = splay(r[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>], v)[<span class="hljs-number">1</span>];
			r[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] = r[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>];
			<span class="hljs-keyword">return</span> r[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>];
		}
	};

	<span class="hljs-keyword">var</span> in_order_traversal = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(pt, fn)</span>{</span>
		<span class="hljs-keyword">if</span>(pt[<span class="hljs-number">0</span>] !== <span class="hljs-literal">null</span>) in_order_traversal(pt[<span class="hljs-number">0</span>], fn);
		fn(pt[<span class="hljs-number">2</span>]);
		<span class="hljs-keyword">if</span>(pt[<span class="hljs-number">1</span>] !== <span class="hljs-literal">null</span>) in_order_traversal(pt[<span class="hljs-number">1</span>], fn);
	};


	<span class="hljs-keyword">var</span> splay_tree = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span> <span class="hljs-keyword">this</span>.pt = <span class="hljs-literal">null</span>; };

	splay_tree.prototype.insert = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(v)</span>{</span>
		<span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.pt === <span class="hljs-literal">null</span>) <span class="hljs-keyword">this</span>.pt = [<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, v];
		<span class="hljs-keyword">else</span> insert(<span class="hljs-keyword">this</span>.pt, v);
	};

	splay_tree.prototype.find = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(v)</span>{</span>
		<span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.pt === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> [<span class="hljs-literal">false</span>, <span class="hljs-literal">null</span>];
		<span class="hljs-keyword">var</span> r = splay(<span class="hljs-keyword">this</span>.pt, v);
		<span class="hljs-keyword">this</span>.pt = r[<span class="hljs-number">1</span>];
		<span class="hljs-keyword">return</span> [r[<span class="hljs-number">0</span>], r[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>]];
	};

	splay_tree.prototype.remove = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(v)</span>{</span>
		<span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.pt !== <span class="hljs-literal">null</span>) <span class="hljs-keyword">this</span>.pt = remove(<span class="hljs-keyword">this</span>.pt, v);
	};

	splay_tree.prototype.in_order_traversal = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span>{</span>
		<span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.pt !== <span class="hljs-literal">null</span>) in_order_traversal(<span class="hljs-keyword">this</span>.pt, fn);
	};

	<span class="hljs-keyword">return</span> splay_tree;

};

exports.splay_tree_3_t = splay_tree_3_t;</div></div></div></div></body></html>